<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>别踩白块儿 - 进阶版</title>
    <style>
        body { margin: 0; background: #333; font-family: Arial; overflow: hidden; display: flex; flex-direction: column; align-items: center; }
        #game-container { position: relative; width: 320px; height: 500px; background: white; border: 5px solid #000; overflow: hidden; cursor: pointer; }
        .row { display: flex; width: 100%; height: 125px; position: absolute; border-bottom: 1px solid #ddd; }
        .cell { flex: 1; border-right: 1px solid #ddd; }
        .black { background: #000 !important; }
        .clicked { background: #bbb !important; }
        #score-board { color: white; font-size: 30px; margin: 20px; }
    </style>
</head>
<body>
    <div id="score-board">得分: 0</div>
    <div id="game-container" id="main"></div>

    <script>
        const container = document.getElementById('game-container');
        const scoreBoard = document.getElementById('score-board');
        let score = 0;
        let speed = 2; // 初始速度
        let timer = null;

        // 初始化：创建 4 行
        function init() {
            for (let i = 0; i < 4; i++) {
                createRow();
            }
            // 每 20 毫秒移动一次
            timer = setInterval(move, 20);
        }

        // 创建一行方块
        function createRow() {
            const row = document.createElement('div');
            row.className = 'row';
            row.style.top = '-125px'; // 从屏幕上方划入

            // 随机一个位置变黑
            const blackIndex = Math.floor(Math.random() * 4);
            for (let i = 0; i < 4; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell' + (i === blackIndex ? ' black' : '');
                row.appendChild(cell);
            }

            // 插入到最前面
            if (container.firstChild) {
                container.insertBefore(row, container.firstChild);
            } else {
                container.appendChild(row);
            }
        }

        // 移动逻辑
        function move() {
            const rows = document.getElementsByClassName('row');
            for (let i = 0; i < rows.length; i++) {
                let top = parseInt(rows[i].style.top);
                top += speed;
                rows[i].style.top = top + 'px';

                // 如果一行超出了底部
                if (top >= 500) {
                    // 检查这行是否有黑块没被点
                    const cells = rows[i].getElementsByClassName('cell');
                    for (let cell of cells) {
                        if (cell.classList.contains('black') && !cell.classList.contains('clicked')) {
                            gameOver();
                        }
                    }
                    container.removeChild(rows[i]);
                    createRow();
                }
            }
        }

        // 点击逻辑
        container.onclick = function(e) {
            const target = e.target;
            if (target.classList.contains('black')) {
                target.classList.add('clicked');
                target.classList.remove('black');
                score++;
                scoreBoard.innerText = "得分: " + score;
                // 每得 5 分，速度加快一点
                if (score % 5 === 0) speed += 0.5;
            } else {
                gameOver();
            }
        };

        function gameOver() {
            clearInterval(timer);
            alert("挑战结束！你的最终得分是: " + score);
            location.reload();
        }

        init();
    </script>
</body>
</html>